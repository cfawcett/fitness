{{- /* File: _superset_block.html
Expects: .Block (a RenderableBlock with >1 exercise), .AllExercises, .ActivityID
*/ -}}

{{- /* Define variables for easier access */ -}}
{{ $block := .Block }}
{{ $allExercises := .AllExercises }}
{{ $activityID := .ActivityID }}

<div id="superset-block-{{(index $block.Exercises 0).SupersetID}}" class="exercise-block bg-zinc-800 p-4 border border-zinc-700 rounded-lg mb-4">
    <h3 class="superset-title font-bold text-cyan-400 border-b border-zinc-700 pb-2 mb-4">Superset</h3>

    {{- /* Loop through each exercise within this block */ -}}
    {{ range $gymExercise := $block.Exercises }}
    <div class="single-exercise-container relative mb-4 pb-4 border-b border-zinc-700 last:border-b-0 last:mb-0 last:pb-0">
        <button type="button"
                hx-post="/gym-exercise/{{$gymExercise.ID}}/remove-from-superset"
                hx-confirm="Remove this exercise from the superset?"
                hx-target="closest .exercise-block"
                hx-swap="outerHTML"
                class="absolute top-0 right-0 text-zinc-500 hover:text-red-500 font-bold text-2xl leading-none"
                title="Remove from Superset">
            &times;
        </button>

        <label class="font-semibold text-zinc-300">Exercise:</label>
        <select name="exercise_id_{{$gymExercise.ID}}"
                required
                hx-put="/gym-exercise/{{$gymExercise.ID}}"
                hx-trigger="change"
                hx-swap="none"
                class="w-full p-2 bg-zinc-700 border border-zinc-600 rounded-md text-white focus:border-cyan-500 focus:ring-cyan-500">
            <option value="" disabled>Select an exercise</option>
            {{ range $allExercises }}
            <option value="{{.ID}}" {{ if eq .ID $gymExercise.ExerciseDefinitionID }}selected{{ end }}>{{.Name}}</option>
            {{ end }}
        </select>

        <h4 class="font-semibold mt-4 mb-2 text-zinc-300">Sets</h4>
        <div id="sets-container-{{$gymExercise.ID}}" class="flex flex-col space-y-2">
            {{- /* Loop through sets and render the partial for each */ -}}
            {{ range $gymExercise.Sets }}
            {{ template "_exercise-set.html" (dict "Set" . ) }}
            {{ end }}
        </div>

        <button type="button"
                hx-post="/gym-exercise/{{$gymExercise.ID}}/add-set"
                hx-target="#sets-container-{{$gymExercise.ID}}"
                hx-swap="beforeend"
                class="text-cyan-400 hover:text-cyan-300 font-semibold mt-3 text-sm border-2 p-2 border-cyan-500 rounded-md">
            + Add Set
        </button>
    </div>
    {{ end }}

    {{- /* This button lets you add another exercise to the existing superset */ -}}
    <div class="flex items-center justify-center pt-2">
        <button type="button"
                hx-get="/ui/add-exercise-modal/{{$activityID}}?sourceExerciseID={{(index $block.Exercises 0).ID}}"
                hx-target="#modal-container"
                class="text-cyan-400 hover:text-cyan-300 font-semibold text-sm border-2 p-2 border-cyan-500 rounded-md">
            + Add to Superset
        </button>
    </div>
</div>